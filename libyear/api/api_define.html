//系统管理 
//获取系统列表
GET /repositories
Query Params:
  - page: integer
  - page_size: integer  

Response:
{
  "data": [
    {
      "id": 1,
      "name": "openEuler-22.03-LTS",
      "display_name": "openEuler 22.03 LTS",
      "type": "rpm",
      "is_active": true,
      "last_sync_time": "2023-11-01T10:30:00Z",
      "last_sync_status": "success",
      "total_packages": 15000,
      "outdated_packages": 1200
    }
  ],
  "pagination": {
    "page": 1,
    "page_size": 20,
    "total": 4,
    "total_pages": 1
  }
}

//获取系统详情
GET /repositories/{id}
Response:
{
  "id": 1,
  "name": "openEuler-22.03-LTS",
  "display_name": "openEuler 22.03 LTS",
  "type": "rpm",
  "base_url": "https://repo.openeuler.org/",
  "is_active": true,
  "sync_enabled": true,
  "sync_interval": 24,
  "last_sync_time": "2023-11-01T10:30:00Z",
  "last_sync_status": "success",
  "created_at": "2023-10-01T00:00:00Z"
}

//手动触发同步
POST /repositories/{id}/sync
Body:
{
  "sync_type": "full"  // or "incremental"
}

Response:
{
  "task_id": "celery-task-uuid",
  "status": "started",
  "message": "同步任务已开始"
}

//软件包查询API
//包列表查询
GET /packages
Query Params:
  - repository_id: integer
  - package_name: string (模糊匹配)
  - language: string
  - is_outdated: boolean
  - min_libyear: number
  - max_libyear: number
  - sort: string (libyear, package_name, days_outdated)
  - order: string (asc, desc)

Response:
{
  "data": [
    {
      "id": 1,
      "package_name": "openssl",
      "display_name": "OpenSSL Toolkit",
      "version": "3.0.5",
      "upstream_version": "3.0.12",
      "libyear": 1.7,
      "days_outdated": 240,
      "language": "C",
      "is_outdated": true,
      "repository_name": "openEuler-22.03-LTS",
      "last_updated": "2023-11-01T10:30:00Z"
    }
  ],
  "pagination": { ... }
}

//包详情查询
GET /packages/{id}
Response:
{
  "id": 1,
  "package_name": "openssl",
  "display_name": "OpenSSL Toolkit",
  "version": "3.0.5",
  "upstream_version": "3.0.12",
  "upstream_release_date": "2023-08-01",
  "system_release_date": "2023-01-01", 
  "libyear": 1.7,
  "days_outdated": 240,
  "source_url": "https://github.com/openssl/openssl",
  "language": "C",
  "website": "https://www.openssl.org/",
  "description": "Toolkit for SSL/TLS protocols",
  "license_type": "Apache-2.0",
  "is_outdated": true,
  "repository": {
    "id": 1,
    "name": "openEuler-22.03-LTS",
    "display_name": "openEuler 22.03 LTS"
  }
}

//包搜索
GET /packages/search
Query Params:
  - q: string (搜索关键词)
  - repository_id: integer

Response:
{
  "data": [
    {
      "id": 1,
      "package_name": "openssl",
      "version": "3.0.5",
      "upstream_version": "3.0.12",
      "libyear": 1.7,
      "repository_name": "openEuler-22.03-LTS",
      "highlight": "OpenSSL Toolkit for <em>SSL</em>"
    }
  ],
  "pagination": { ... }
}

//统计分析API
//系统概览统计
GET /analysis/overview
Response:
{
  "total_repositories": 4,
  "total_packages": 60000,
  "total_outdated_packages": 4800,
  "global_avg_libyear": 0.8,
  "repositories_stats": [
    {
      "repository_id": 1,
      "repository_name": "openEuler-22.03-LTS",
      "total_packages": 15000,
      "outdated_packages": 1200,
      "avg_libyear": 0.7
    }
  ]
}

//libyear分布统计
GET /analysis/libyear-distribution
Query Params:
  - repository_id: integer

Response:
{
  "distribution": [
    {"range": "0-0.5", "count": 12000, "percentage": 80.0},
    {"range": "0.5-1", "count": 1500, "percentage": 10.0},
    {"range": "1-2", "count": 1000, "percentage": 6.7},
    {"range": "2+", "count": 500, "percentage": 3.3}
  ],
  "stats": {
    "avg_libyear": 0.7,
    "median_libyear": 0.3,
    "max_libyear": 5.2
  }
}

//语言统计
GET /analysis/language-stats
Query Params:
  - repository_id: integer

Response:
{
  "languages": [
    {
      "language": "C",
      "package_count": 5000,
      "outdated_count": 400,
      "avg_libyear": 0.6
    },
    {
      "language": "Python", 
      "package_count": 3000,
      "outdated_count": 600,
      "avg_libyear": 1.2
    }
  ]
}

//最过期包TOP N 
GET /analysis/top-outdated
Query Params:
  - repository_id: integer
  - limit: integer (default: 50)

Response:
{
  "packages": [
    {
      "id": 123,
      "package_name": "old-package",
      "version": "1.0.0",
      "upstream_version": "5.0.0", 
      "libyear": 5.2,
      "days_outdated": 1895,
      "repository_name": "openEuler-22.03-LTS"
    }
  ]
}

